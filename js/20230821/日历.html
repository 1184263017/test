<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="../20230822/nongli.js"></script>
    <title>Document</title>
    <style>
        .rli {
            width: 280px;
            margin: 0 auto;
            display: flex;
            flex-wrap: wrap;
            background-color: rgb(229, 229, 229);
            border-radius: 5px;
            padding-top: 5px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.5);
        }

        .rli>div {
            width: 40px;
            height: 40px;
            box-sizing: border-box;
            text-align: center;
            font-size: 14px;
        }

        .divT:hover {
            border-radius: 50%;
            background-color: rgb(200, 200, 200);
            color: black !important;
            transition: all .5s;
        }

        .divT {
            display: flex;
            flex-direction: column;
            border-radius: 50%;
        }

        .divT>span {
            margin-top: 2px;
            font-size: 12px;
            transform: scale(.9);
        }

        #but {
            /* border: solid; */
            margin: 0 auto;
            margin-top: 3vh;
            width: 7.1vw;
        }

        #years {
            display: inline-block;
            width: 1vw;
            outline: none;
            text-align: center;
        }

        #shang,
        #xia {
            width: 2.5vw;
            background-color: skyblue;
            color: white;
            border-radius: 3px;
            border: none;
            font-size: 14px;
        }
    </style>
</head>

<body>
    <div id="rli" class="rli">
        <div>一</div>
        <div>二</div>
        <div>三</div>
        <div>四</div>
        <div>五</div>
        <div>六</div>
        <div>日</div>
    </div>
    <div id="but">
        <input type="button" value="上月" id="shang">
        <input type="text" name="" id="years" value="">
        <input type="button" value="下月" id="xia">
    </div>
    <script>
        document.getElementById('years').value = new Date().getMonth() + 1;
        const arr = ['国庆节', '中秋节', '劳动节', '元旦节', '春节', '端午节', '除夕']
        function createCalendar(elem, year, month) {
            const shangyue = new Date(year, month - 1, 0).getDate();
            const max = new Date(year, month, 0).getDate();
            const sta_rl = new Date(year, month - 1, 1).getDay() || 7;
            const end_rl = 7 - (new Date(year, month - 1, max).getDay() || 7);
            for (let i = sta_rl; i > 1; i--) {
                const div = document.createElement('div');
                div.className = 'divT'
                div.innerHTML = shangyue - i + 2;
                div.style.color = 'rgb(194,194,194)'
                const str = getTiem(year, month - 1, shangyue - i + 2);
                div.innerHTML = `
                    <span>${shangyue - i + 2}</span>
                    <span>${str}</span>
                `;
                elem.append(div)
            }
            for (let i = 1; i <= max; i++) {
                const div = document.createElement('div');
                div.className = 'divT'
                if (new Date().getDate() == i) {
                    div.style.color = 'rgb(255,255,255)';
                    div.style.borderRadius = '50%';
                    div.style.backgroundColor = 'rgb(0,103,192)';
                }
                const str = getTiem(year, month, i);
                div.innerHTML = `
                    <span>${i}</span>
                    <span>${str}</span>
                `;
                elem.append(div)
            }
            for (let i = 1; i <= end_rl; i++) {
                const div = document.createElement('div');
                div.className = 'divT'
                div.style.color = 'rgb(194,194,194)'
                const str = getTiem(year, month + 1, i);
                div.innerHTML = `
                    <span>${i}</span>
                    <span>${str}</span>
                `;
                elem.append(div)
            }
        }
        const rli = document.getElementById('rli')
        createCalendar(rli, new Date().getFullYear(), new Date().getMonth() + 1);

        function getTiem(year, month, date) {
            const lunarDate = LunarCalendar.solarToLunar(year, month, date);
            let str;
            if (lunarDate.solarFestival != undefined && arr.includes(lunarDate.solarFestival.split(' ')[0])) {
                str = lunarDate.solarFestival.split(' ')[0]
            } else if (lunarDate.lunarFestival != undefined && arr.includes(lunarDate.lunarFestival.split(' ')[0])) {
                str = lunarDate.lunarFestival.split(' ')[0]
            } else if (lunarDate.term) {
                str = lunarDate.term
            } else if (lunarDate.lunarDayName == '初一') {
                str = lunarDate.lunarMonthName
            } else {
                str = lunarDate.lunarDayName
            }
            return str;
        }


        let num = new Date().getMonth() + 1;
        document.getElementById('shang').addEventListener('click', function () {
            num = num - 1
            num = num < 1 ? 12 : num;
            for (let i = rli.children.length; i > 6; i--) {
                if (rli.children[i] == undefined) {
                    continue;
                }
                rli.removeChild(rli.children[i])
            }
            createCalendar(rli, new Date().getFullYear(), num);
            document.getElementById('years').value = num;
        })
        document.getElementById('xia').addEventListener('click', function () {
            num = num + 1
            num = num > 12 ? 1 : num;
            for (let i = rli.children.length; i > 6; i--) {
                if (rli.children[i] == undefined) {
                    continue;
                }
                rli.removeChild(rli.children[i])
            }
            createCalendar(rli, new Date().getFullYear(), num);
            document.getElementById('years').value = num;
        })
        document.getElementById('years').addEventListener('keydown', function (event) {
            if (event.keyCode === 13 || event.which === 13) {
                // 在这里执行你希望在回车键按下时执行的操作
                num = +document.getElementById('years').value;
                console.log(num);
                num = num > 12 ? 1 : num;
                num = num < 1 ? 12 : num;
                for (let i = rli.children.length; i > 6; i--) {
                    if (rli.children[i] == undefined) {
                        continue;
                    }
                    rli.removeChild(rli.children[i])
                }
                createCalendar(rli, new Date().getFullYear(), num);
                document.getElementById('years').value = num;
            }

        })


        


        // 使用 lunarCalendar 的方法获取农历日期
        const lunarDate = LunarCalendar.solarToLunar(2023, 1, 21);
        // console.log(lunarDate);

    </script>
</body>

</html>